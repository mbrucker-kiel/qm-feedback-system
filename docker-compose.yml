services:
    app:
        build: .
        container_name: qm-feedback-app
        ports:
            - "8002:8002"
        volumes:
            - .:/app
        environment:
            - MODULE_NAME=main
            - VARIABLE_NAME=app
            - PORT=8002
        # Command to run uvicorn in production mode (or use --reload for dev)
        command: uvicorn main:app --host 0.0.0.0 --port 8002 --root-path /feedback --proxy-headers --forwarded-allow-ips "*"

    db:
        image: postgres:17
        container_name: qm-feedback-db
        restart: always
        environment:
            - POSTGRES_DB=${POSTGRES_DB}
            - POSTGRES_USER=${POSTGRES_USER}
            - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
        volumes:
            - postgres_data:/var/lib/postgresql/data

volumes:
    postgres_data:
